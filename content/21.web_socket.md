---
@meta:
{
    "group": "Advanced Features",
    "icon": "ph-duotone ph-broadcast"
}
---
# WebSocket Guide

Welcome to the Finch WebSocket Guide! This guide will walk you through the steps to use WebSocket in your Finch application. Whether you're a seasoned developer or just starting, Finch offers a robust set of tools to simplify server-side web app development.


## Using WebSocket in Finch

For defining WebSocket for your Finch application, you need to use the `SocketManager` class. The `SocketManager` class is used to manage WebSocket connections in your Finch application. It contains all the necessary properties to manage WebSocket connections. and then you can use the `addSocketRoute` method to add your WebSocket routes to your Finch application. after that you can use the `socketController` to handle the WebSocket connection.

## SocketManager

The `SocketManager` class is used to manage WebSocket connections in your Finch application. It contains all the necessary properties to manage WebSocket connections. Here is an example of how to use it:

```dart
final socketManager = SocketManager(
  app,
  event: SocketEvent(
    onConnect: (socket) {
      app.socketManager?.sendToAll(
        "New user connected! count: ${app.socketManager?.countClients}",
        path: "output",
      );
      socket.send(
        {'message': 'Soccuess connect to socket!'},
        path: 'connected',
      );
    },
    onMessage: (socket, data) {},
    onDisconnect: (socket) {
      var count = app.socketManager?.countClients ?? 0;
      app.socketManager?.sendToAll(
        "User disconnected! count: ${count - 1}",
        path: "output",
      );
    },
  ),
  routes: getSocketRoute(),
);
```

# SocketEvent

The `SocketEvent` class is used to define the events that can be triggered in a WebSocket connection. It contains all the necessary properties to define the events. Here is an example of how to use it:

```dart
  'time': SocketEvent(
      onMessage: (socket, data) {
        socket.send(DateTime.now().toString(), path: 'output');
      },
    ),
```

# WebSocket Route

WebSocket routes are defined in the `getSocketRoute` function. This function returns a `Map<String, SocketEvent>` that contains all the WebSocket routes. Here is an example of how to use it:

```dart
Map<String, SocketEvent> getSocketRoute() {
  return {
    'test': SocketEvent(
      onMessage: (socket, data) {
        socket.send([socket.rq.headers], path: 'test');
      },
    ),
  };
}
```

## Adding your socket routes to FinchApp

`getSocketRoute()` is a function that returns a `Map<String, SocketEvent>`. You can add it to your `FinchApp` instance by using the `addSocketRoute` method. Here is an example of how to use it:

```dart
class SocketController exatends Controller {
  Future<String> socket() async {
    await socketManager.requestHandle(rq);
    return rq.renderSocket();
  }
}
```

```dart
FinchRoute(
    key: 'root.ws',
    path: '/ws',
    methods: Methods.ALL,
    index: socketController.socket,
),
```



